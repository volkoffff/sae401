{% extends 'base.html.twig' %}


{% block body %}
    <aside class="fixed z-40 w-80 h-screen transition-transform -translate-x-full left-full overflow-hidden" style="left:100%" aria-label="Sidebar">
        <div class="flex flex-col h-full overflow-y-auto overflow-hidden">
            <div class="h-full rounded-l-xl bg-gray-200 px-3 py-3 mt-28 blury pr-6 overflow-hidden">
                <div class="pb-3 border-b-2 border-zinc-500/10">
                    <div class="text-xl font-semibold text-purple-900 flex items-center justify-between text-zinc-300">
                        <p>
                            Social

                        </p>
                        <div class="flex gap-2 text-zinc-500">
                            <a href="#" id="toggle_search_friend_button" class="bg-zinc-600/10 hover:bg-zinc-600/30 p-2 rounded-lg"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 24 24" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M10,18c1.846,0,3.543-0.635,4.897-1.688l4.396,4.396l1.414-1.414l-4.396-4.396C17.365,13.543,18,11.846,18,10 c0-4.411-3.589-8-8-8s-8,3.589-8,8S5.589,18,10,18z M10,4c3.309,0,6,2.691,6,6s-2.691,6-6,6s-6-2.691-6-6S6.691,4,10,4z"></path></svg>
                            </a>
                            <a href="" class="bg-zinc-600/10 hover:bg-zinc-600/30 p-2 rounded-lg"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 512 512" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M433 288.8c-7.7 0-14.3 5.9-14.9 13.6-6.9 83.1-76.8 147.9-161.8 147.9-89.5 0-162.4-72.4-162.4-161.4 0-87.6 70.6-159.2 158.2-161.4 2.3-.1 4.1 1.7 4.1 4v50.3c0 12.6 13.9 20.2 24.6 13.5L377 128c10-6.3 10-20.8 0-27.1l-96.1-66.4c-10.7-6.7-24.6.9-24.6 13.5v45.7c0 2.2-1.7 4-3.9 4C148 99.8 64 184.6 64 288.9 64 394.5 150.1 480 256.3 480c100.8 0 183.4-76.7 191.6-175.1.8-8.7-6.2-16.1-14.9-16.1z"></path></svg>
                            </a>
                        </div>

                    </div>
                    <form id="search_friend" class="flex items-center w-full mt-1" style="display: none;">
                        <div class=" relative z-0 w-full">
                            <input type="text" id="search_ami"
                                   class="block py-1 px-0 w-full text-sm text-gray-900 bg-transparent border-0 border-l-2 pl-2 border-zinc-500 appearance-none focus:outline-none focus:ring-0 focus:border-orange-500 peer text-zinc-300"
                                   placeholder="chercher un joueur" />
                        </div>
                    </form>
                </div>
                <div class=" overflow-y-scroll h-full invisible_scroll pb-16">
                    <button class="accordion text-zinc-400">Amis</button>
                    <div class="panel ">
                        {% for friend in friends %}
                            {% if friend.user.id == user.id %}
                            <a href="#"
                               class=" ami flex items-center rounded-xl px-3 py-5 justify-between w-full bg-zinc-600/10 hover:bg-zinc-600/30">
                                <div class="flex items-center">
                                    <div class="mr-3 sm:h-9 w-9 h-9 rounded-xl bg-cover bg-center"
                                         style="background-image: url({{ asset('uploads/' ~ friend.user.avatar) }}); background-color: {{ friend.user.couleur }};">
                                    </div>
                                    <div>
                                        <p class="self-center text-l font-semibold whitespace-nowrap leading-none text-zinc-300">
                                            {{ friend.friend.pseudo }}
                                        </p>
                                        <p class=" text-base leading-none mt-1 text-zinc-500">{{ friend.friend.biographie }}</p>
                                    </div>
                                </div>
                                <p class="text-xl flex items-center gap-1 text-zinc-500">{{ friend.friend.trophee }}<svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M868 160h-92v-40c0-4.4-3.6-8-8-8H256c-4.4 0-8 3.6-8 8v40h-92a44 44 0 0 0-44 44v148c0 81.7 60 149.6 138.2 162C265.7 630.2 359 721.7 476 734.5v105.2H280c-17.7 0-32 14.3-32 32V904c0 4.4 3.6 8 8 8h512c4.4 0 8-3.6 8-8v-32.3c0-17.7-14.3-32-32-32H548V734.5C665 721.7 758.3 630.2 773.8 514 852 501.6 912 433.7 912 352V204a44 44 0 0 0-44-44zM184 352V232h64v207.6a91.99 91.99 0 0 1-64-87.6zm520 128c0 49.1-19.1 95.4-53.9 130.1-34.8 34.8-81 53.9-130.1 53.9h-16c-49.1 0-95.4-19.1-130.1-53.9-34.8-34.8-53.9-81-53.9-130.1V184h384v296zm136-128c0 41-26.9 75.8-64 87.6V232h64v120z"></path></svg>
                                </p>
                            </a>
                        {% else %}
                            <a href="#"
                               class=" ami flex items-center rounded-xl px-3 py-5 justify-between w-full bg-zinc-600/10 hover:bg-zinc-600/30">
                                <div class="flex items-center">
                                    <div class="mr-3 sm:h-9 w-9 h-9 rounded-xl bg-cover bg-center"
                                         style="background-image: url({{ asset('uploads/' ~ friend.user.avatar) }});">
                                    </div>
                                    <div>
                                        <p class="self-center text-l font-semibold whitespace-nowrap leading-none text-zinc-300">
                                            {{ friend.user.pseudo }}
                                        </p>
                                        <p class=" text-base leading-none mt-1 text-zinc-500">{{ friend.user.pseudo }}</p>
                                    </div>
                                </div>
                                <p class="text-xl flex items-center gap-1 text-zinc-500">{{ friend.user.trophee }}<svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M868 160h-92v-40c0-4.4-3.6-8-8-8H256c-4.4 0-8 3.6-8 8v40h-92a44 44 0 0 0-44 44v148c0 81.7 60 149.6 138.2 162C265.7 630.2 359 721.7 476 734.5v105.2H280c-17.7 0-32 14.3-32 32V904c0 4.4 3.6 8 8 8h512c4.4 0 8-3.6 8-8v-32.3c0-17.7-14.3-32-32-32H548V734.5C665 721.7 758.3 630.2 773.8 514 852 501.6 912 433.7 912 352V204a44 44 0 0 0-44-44zM184 352V232h64v207.6a91.99 91.99 0 0 1-64-87.6zm520 128c0 49.1-19.1 95.4-53.9 130.1-34.8 34.8-81 53.9-130.1 53.9h-16c-49.1 0-95.4-19.1-130.1-53.9-34.8-34.8-53.9-81-53.9-130.1V184h384v296zm136-128c0 41-26.9 75.8-64 87.6V232h64v120z"></path></svg>
                                </p>
                            </a>
                            {% endif %}
                        {% endfor %}
                    </div>
                    <button class="accordion  text-zinc-400 flex gap-2">Demandes en attente
                        <p id="afficheur_compteur_ami" class="rounded w-5 h-5 flex items-center justify-center main-orange mt-0.5 text-zinc-300 text-sm">
                        </p>
                    </button>
                    <div class="panel" id="compteur_ami">
                        {% for friend in friendsR %}
                        <div class=" ami flex items-center rounded-xl px-3 py-5 justify-between w-full bg-zinc-600/10 hover:bg-zinc-600/30">
                            <div class="flex items-center">
                                <div class="mr-3 sm:h-9 w-9 h-9 rounded-xl bg-cover bg-center"
                                     style="background-image: url({{ asset('uploads/' ~ friend.user.avatar) }}); background-color: {{ friend.user.couleur }};">
                                </div>
                                <div>
                                    <p class="self-center text-l font-semibold whitespace-nowrap leading-none text-zinc-300">
                                        {{ friend.user.pseudo }}
                                    </p>
                                    <p class=" text-base leading-none mt-1 text-zinc-500">{{ friend.user.biographie }}</p>
                                </div>
                            </div>
                            {% if friend.status == 'pending' %}
                                <p class="text-xl flex items-center gap-2 text-gray-500">
                                <form action="{{ path('accept_friend_request', {'friendId': friend.user.id}) }}" method="POST" style="display: inline">
                                    <button type="submit" onclick="countAndDisplayElements()" class=" bg-zinc-600/10 hover:bg-zinc-600/30 p-2 rounded-lg text-green-500" data-tooltip-target="accept_ami"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M912 190h-69.9c-9.8 0-19.1 4.5-25.1 12.2L404.7 724.5 207 474a32 32 0 0 0-25.1-12.2H112c-6.7 0-10.4 7.7-6.3 12.9l273.9 347c12.8 16.2 37.4 16.2 50.3 0l488.4-618.9c4.1-5.1.4-12.8-6.3-12.8z"></path></svg></button>
                                    <input type="hidden" name="_method" value="PUT">
                                    <input type="hidden" name="_token" value="{{ csrf_token('accept' ~ friend.user.id) }}">
                                </form>
                                <form action="{{ path('decline_friend_request', {'friendId': friend.user.id}) }}" method="POST" style="display: inline">
                                    <button onclick="countAndDisplayElements()" type="submit" class=" bg-zinc-600/10 hover:bg-zinc-600/30 p-2 rounded-lg text-red-500" data-tooltip-target="refuse_ami"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M563.8 512l262.5-312.9c4.4-5.2.7-13.1-6.1-13.1h-79.8c-4.7 0-9.2 2.1-12.3 5.7L511.6 449.8 295.1 191.7c-3-3.6-7.5-5.7-12.3-5.7H203c-6.8 0-10.5 7.9-6.1 13.1L459.4 512 196.9 824.9A7.95 7.95 0 0 0 203 838h79.8c4.7 0 9.2-2.1 12.3-5.7l216.5-258.1 216.5 258.1c3 3.6 7.5 5.7 12.3 5.7h79.8c6.8 0 10.5-7.9 6.1-13.1L563.8 512z"></path></svg></button>
                                    <input type="hidden" name="_method" value="DELETE">
                                    <input type="hidden" name="_token" value="{{ csrf_token('decline' ~ friend.user.id) }}">
                                </form>
                                <div id="accept_ami" role="tooltip"
                                     class="absolute z-10 invisible inline-block px-3 py-2 text-sm font-medium text-white transition-opacity duration-300 rounded-lg shadow-sm opacity-0 tooltip bg-zinc-900">
                                    Accepter
                                    <div class="tooltip-arrow" data-popper-arrow></div>
                                </div>
                                <div id="refuse_ami" role="tooltip"
                                     class="absolute z-10 invisible inline-block px-3 py-2 text-sm font-medium text-white transition-opacity duration-300 rounded-lg shadow-sm opacity-0 tooltip bg-zinc-900">
                                    Refuser
                                    <div class="tooltip-arrow" data-popper-arrow></div>
                                </div>
                            {% endif %}
                        </div>
                    {% endfor %}
                    </div>
                    <button class="accordion  text-zinc-400">Joueurs</button>
                    <div class="panel">
                        {% for user in users %}
                            {% if user.id == userConnecter.id %}
                            {% else %}
                            <div class=" ami flex items-center rounded-xl px-3 py-5 justify-between w-full bg-zinc-600/10 hover:bg-zinc-600/30">
                                <div class="flex items-center">
                                    <div class="mr-3 sm:h-9 w-9 h-9 rounded-xl bg-cover bg-center" style="background-image: url({{ asset('uploads/' ~ user.avatar) }}); background-color: {{ user.couleur }}">
                                    </div>
                                    <div>
                                        <p class="self-center text-l font-semibold whitespace-nowrap leading-none text-zinc-300">
                                            {{ user.pseudo }}
                                        </p>
                                        <p class=" text-base leading-none mt-1 text-zinc-500">{{ user.biographie }}</p>
                                    </div>
                                </div>
                                <form class="text-xl flex items-center gap-2 text-gray-500" action="{{ path('send_friend_request', {'friendId': user.id}) }}" method="post" style="display: inline;">
                                    <button type="submit" class="bg-zinc-600/10 hover:bg-zinc-600/30 p-2 rounded-lg text-green-500"
                                            data-tooltip-target="add_ami"><svg stroke="currentColor" fill="none"
                                                                               stroke-width="0" viewBox="0 0 24 24" height="1em" width="1em"
                                                                               xmlns="http://www.w3.org/2000/svg">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                                  d="M18 9v3m0 0v3m0-3h3m-3 0h-3m-2-5a4 4 0 11-8 0 4 4 0 018 0zM3 20a6 6 0 0112 0v1H3v-1z">
                                            </path>
                                        </svg></button>
                                </form>
                                <div id="add_ami" role="tooltip"
                                     class="absolute z-10 invisible inline-block px-3 py-2 text-sm font-medium text-white transition-opacity duration-300 rounded-lg shadow-sm opacity-0 tooltip bg-zinc-900">
                                    Envoyer une demande d'ami
                                    <div class="tooltip-arrow" data-popper-arrow></div>
                                </div>
                            </div>
                                {% endif %}
                        {% endfor %}
                    </div>
                </div>
            </div>
        </div>
    </aside>
    {% for type, messages in app.flashes() %}
        {% for message in messages %}
            <div id="toast-danger" class="alert alert-{{ type }} flex items-center w-full max-w-xs p-4 mb-4 text-gray-500 rounded-lg shadow blury fixed z-50 bottom-2 left-6 border-2 border-red-700/20" role="alert">
                <div class="inline-flex items-center justify-center flex-shrink-0 w-8 h-8  rounded-lg bg-red-700/20">
                    <svg aria-hidden="true" class="w-5 h-5 text-red-500" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clip-rule="evenodd"></path></svg>
                    <span class="sr-only ">Warning icon</span>
                </div>
                <div class="ml-3 text-sm font-normal">{{ message }}</div>
                <button type="button" class="ml-auto -mx-1.5 -my-1.5 text-zinc-500 rounded-lg focus:ring-2 focus:ring-gray-300 p-1.5 inline-flex h-8 w-8 bg-zinc-600/10 hover:bg-zinc-600/30" data-dismiss-target="#toast-danger" aria-label="Close">
                    <span class="sr-only">Close</span>
                    <svg aria-hidden="true" class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path></svg>
                </button>
            </div>
        {% endfor %}
    {% endfor %}
    <div class="flex w-full" style="background-image: url({{ asset("uploads/fond_1.svg") }});">
        <div class="h-screen flex-auto px-6">
            <div class="mt-28 h-full w-full border-dashed border-2 border-sky-500"></div>
        </div>
        <div class="h-screen w-80">
        </div>
    </div>
















    {{ form_start(biographie_form) }}
    {{ form_widget(biographie_form) }}
    <button type="submit">Save</button>
    {{ form_end(biographie_form) }}


    <h1>Mon profil</h1>
    <p>Nom d'utilisateur : {{ user.pseudo }}</p>
    <p>Email : {{ user.email }}</p>
    <p>trophées : {{ user.trophee }}</p>
    <p>win : {{ user.victoire }}</p>
    <p>loose : {{ user.defaite }}</p>
    <hr>

    <p class="text-xl font-bold">Leaderboard</p>
    {% for leader in leaders %}
        {{ leader.pseudo }}
        {{ leader.trophee }}
        <br>
    {% endfor %}
    <hr>
{#    <h2>historique de tt les parties</h2>#}
{#    <button id="toggleButton">Afficher uniquement les parties en cours</button>#}
{#    {% for partie in parties %}#}
{#        {% if partie.statut == 'terminé' %}#}
{#            <div id="terminer">#}
{#            {{ partie.id }}#}
{#            {{ partie.statut }}#}
{#            {{ partie.resultat }}#}
{#            </div>#}
{#        {% else %}#}
{#            <div id="enCours">#}
{#                {{ partie.id }}#}
{#                {{ partie.statut }}#}
{#                {{ partie.resultat }}#}
{#            </div>#}
{#        {% endif %}#}
{#    {% endfor %}#}
{#    <hr>#}
{#    <h2>historique des partie du user</h2>#}
{#    {% for partie in partiesDuUser %}#}
{#        <li>#}
{#            {{ partie.id }} - {{ partie.statut }}#}
{#        </li>#}
{#    {% endfor %}#}





















{#    <hr>#}
{#    <br>#}
{#    <hr>#}
{#    <h2>vos amis</h2>#}
{#    {% for friend in friends %}#}
{#        {{ friend.friend.pseudo }}#}
{#        {{ friend.status }}#}
{#    {% endfor %}#}
{#    {% for friend in friends2 %}#}
{#        {{ friend.user.pseudo }}#}
{#        {{ friend.status }}#}
{#    {% endfor %}#}

{#    <h2>liste des joueurs</h2>#}
{#    {% for user in users %}#}
{#        {{ user.pseudo }}#}
{#        <form action="{{ path('send_friend_request', {'friendId': user.id}) }}" method="post" style="display: inline;">#}
{#            <button type="submit">Ajouter</button>#}
{#        </form>#}
{#        <br>#}
{#    {% endfor %}#}
{#    <hr>#}
{#    <h2>liste de demande d'ami</h2>#}
{#    {% for friend in friendsR %}#}
{#        {{ friend.user.pseudo }}#}
{#        {% if friend.status == 'pending' %}#}
{#            <form action="{{ path('accept_friend_request', {'friendId': friend.user.id}) }}" method="POST" style="display: inline">#}
{#                <button type="submit">Accepter</button>#}
{#                <input type="hidden" name="_method" value="PUT">#}
{#                <input type="hidden" name="_token" value="{{ csrf_token('accept' ~ friend.user.id) }}">#}
{#            </form>#}
{#            <form action="{{ path('decline_friend_request', {'friendId': friend.user.id}) }}" method="POST" style="display: inline">#}
{#                <button type="submit">Refuser</button>#}
{#                <input type="hidden" name="_method" value="DELETE">#}
{#                <input type="hidden" name="_token" value="{{ csrf_token('decline' ~ friend.user.id) }}">#}
{#            </form>#}
{#        {% endif %}#}
{#    {% endfor %}#}


    <hr>
    <br>
    <hr>

    <p class="text-2xl">Partie 2eme version</p>
    <p class="text-xl font-bold">toute les parties</p>
    {% for partie in parties %}
        {% if partie.statut == 'terminé' %}
            <div id="terminer">
                {{ partie.id }}
                {{ partie.statut }}
            </div>
        {% else %}
            <div id="enCours">
                {{ partie.id }}
                {{ partie.statut }}
            </div>
        {% endif %}
    {% endfor %}
    <p class="text-xl font-bold">toute les parties en attente d'un joeur</p>
    {% for partie in parties %}
        {% if partie.statut == 'en attente' %}
            <div id="enAttente">
                {{ partie.id }}
                {{ partie.statut }}
                <form action="{{ path('join_partie' , {'partieId': partie.id}) }}" type="post">
                    <button type="submit">rejoindre la partie</button>
                </form>
            </div>
        {% endif %}
    {% endfor %}
    <p class="text-xl font-bold">partie dans lequel est le joueur</p>
    {% for partiesDuUserr in partiesDuUser %}
        {{ partiesDuUserr.id }}
    {% if partiesDuUserr.user1.id == user.id %}
        {{ partiesDuUserr.user2.pseudo }}
    {% else %}
        {{ partiesDuUserr.user1.pseudo }}
    {% endif %}
        {{ partiesDuUserr.statut }}
        <br>
    {% endfor %}


    <p class="text-xl font-bold">partie des amis en attente d'un joueur</p>
    {% if partiesAmis|length > 0 %}
        {% for partiesAmi in partiesAmis %}
            {{ partiesAmi.id }} - {{ partiesAmi.user1.pseudo }} - {{ partiesAmi.statut }}
            <form action="{{ path('join_partie' , {'partieId': partiesAmi.id}) }}" type="post">
                <button type="submit">rejoindre la partie</button>
            </form>
            <br>
        {% endfor %}
    {% endif %}

    <h2>boutton créer une partie</h2>
    <form action="{{ path('create_partie') }}" type="post">
        <input type="text" >
        <button type="submit">créer une partie</button>
    </form>























    <script>
        function toggleElements() {
            var elements = document.querySelectorAll("#terminer");
            for (var i = 0; i < elements.length; i++) {
                if (elements[i].style.display === "none") {
                    elements[i].style.display = "block";
                    button.innerHTML = "Afficher uniquement les parties en cours"
                } else {
                    elements[i].style.display = "none";
                    button.innerHTML = "Afficher toutes les parties"
                }
            }
        }

        var button = document.querySelector("#toggleButton");
        button.addEventListener("click", toggleElements);



    </script>

{% endblock %}
